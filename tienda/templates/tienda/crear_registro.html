<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="../../static/tienda/style/sylecss.css">

</head>

<body>

    <!-- NAVBAR-->
    <nav class="navbar navbar-expand-md bg-dark sticky-top border-bottom" data-bs-theme="dark">
        <div class="container">
            <img src="../../static/tienda/img/logo-blanco.png" alt="" width="30">
            <a class="navbar-brand d-md-none" href="{% url 'home' %}">
                <a class="navbar-brand" href="{% url 'home' %}">RAYITO</a>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvas"
                aria-controls="offcanvas" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvas" aria-labelledby="offcanvasLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasLabel">RAYITO</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <ul class="navbar-nav flex-grow-1 justify-content-between">
                        <li class="nav-item"><a class="nav-link" href="#">
                                <svg class="bi" width="24" height="24">
                                    <use xlink:href="{% url 'home' %}"></use>
                                </svg>
                            </a>
                        </li>
                        <!-- Categorias-->
                        {% for categoria in categoria %}
                        <li class="nav-item dropdown">
                            <a fill="currentColor"
                                href="{% url 'categoria_vista' categoria.nombre categoria.id %}">{{categoria.nombre}}</a>
                        </li>
                        {% endfor %}
                        <!-- Fin Categorias-->
                        <form class="d-flex" role="search">
                            <input class="form-control me-2" type="Buscar" placeholder="Buscar" aria-label="Buscar">
                            <button class="btn btn-outline-success" type="submit"><i class="bi bi-search"></i></button>
                        </form>
                        <li class="nav-item">
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor"
                                class="bi bi-person-circle" viewBox="0 0 16 16">
                                <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
                                <path fill-rule="evenodd"
                                    d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1" />
                            </svg>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>


    <!-- Formulario -->
    <div class="container" style="margin-bottom: 50px;">
        <div class="py-5 text-center">
            <h2>Formulario de Registro</h2>
        </div>
        <div class="row">
            <h4 class="mb-3">Datos</h4>
            <form class=" validar" novalidate method="post" action="{% url 'registrar_usuario' %}">
                {% csrf_token %}
                <div class="row g-3">
                    <div class="col-sm-6">
                        <label for="nombre" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="nombre" name="nombre" value="" required>
                        <div class="invalid-feedback">
                            El nombre es obligatorio.
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <label for="apellido" class="form-label">Apellido</label>
                        <input type="text" class="form-control" id="apellido" name="apellido" value="" required>
                        <div class="invalid-feedback">
                            El apellido es obligatorio.
                        </div>
                    </div>
                    <div class="col-12">
                        <label for="Email" class="form-label">Email</label>
                        <div class="input-group has-validation">
                            <span class="input-group-text">@</span>
                            <input type="email" class="form-control" id="Email" name="email" required>
                            <div class="invalid-feedback">
                                Por favor ingresa un correo válido.
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <label for="ConfirmEmail" class="form-label"> Confirmar Email</label>
                        <div class="input-group has-validation">
                            <span class="input-group-text">@</span>
                            <input type="email" class="form-control" id="ConfirmEmail" required>
                            <div class="invalid-feedback">
                                Los correos electrónicos no coinciden.
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <label for="Contrasena" class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="Contrasena" name="contrasena" required>
                        <div class="invalid-feedback">
                            La contraseña es obligatoria.
                        </div>
                    </div>
                    <div class="col-12">
                        <label for="ConfirmContrasena" class="form-label">Repite contraseña</label>
                        <input type="password" class="form-control" id="ConfirmContrasena" name="confirm_contrasena"
                            required>
                        <div class="invalid-feedback">
                            Las contraseñas no coinciden.
                        </div>
                    </div>
                    <hr class="my-4">
                    <button class="w-100 btn btn-success btn-lg registrar" type="submit">Registrar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="container-fluid bg-dark ">
        <div class="row" style="padding: 3%;color: #f8f9fa;">
            <div class="col-12 col-md">
                <img src="../../static/tienda/img/logo-blanco.png" width="50" alt="">
                <a class="navbar-brand d-md-none" href="{% url 'home' %}">
                    <a class="navbar-brand" href="{% url 'home' %}">RAYITO</a>
                </a>
            </div>
            <div class="col-6 col-md">
                <ul class="list-unstyled text-small">
                    <li><a href="{% url 'sobre_nosotros' %}">
                            <h5 class="titulo_blanco">Sobre nosotros</h5>
                        </a></li>
                </ul>
                <ul class="list-unstyled text-small">
                    <li><a href="{% url 'politicas' %}">
                            <h5 class="titulo_blanco">Politicas de Privacidad</h5>
                        </a></li>
                </ul>
            </div>
            <div class="col-6 col-md ">
                <div class="d-flex justify-content-center">
                    <h5>Síguenos</h5>
                </div>
                <div class="d-flex justify-content-center">
                    <div> <a href="url facebook"><i class="bi bi-facebook"></i></a> </div>
                    <div> <a href="url twitter"><i class="bi bi-twitter"></i></a> </div>
                    <div> <a href="url instagram"><i class="bi bi-instagram"></i></a></div>
                </div>
            </div>
        </div>
    </footer>

    <!-- SCRIPT -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>
        $(document).ready(function () {
            $('.registrar').on('click', function (event) {
                event.preventDefault();  
                event.stopPropagation();
                var form = document.querySelector('.validar');
                var estado = 0;

                // Valida si los correos son iguales
                var email = $('#Email').val();
                var confirmEmail = $('#ConfirmEmail').val();

                if (email !== confirmEmail) {
                    event.preventDefault();
                    event.stopPropagation();
                    $('#ConfirmEmail').val('');
                    $('#ConfirmEmail').addClass('is-invalid');
                } else {
                    $('#ConfirmEmail').removeClass('is-invalid').addClass('is-valid');
                    estado++;
                }

                // Validar que las contraseñas sean iguales
                var password = $('#Contrasena').val();
                var confirmPassword = $('#ConfirmContrasena').val();

                if (password !== confirmPassword) {
                    event.preventDefault();
                    event.stopPropagation();
                    $('#ConfirmContrasena').addClass('is-invalid');
                } else {
                    $('#ConfirmContrasena').removeClass('is-invalid').addClass('is-valid');
                    estado++
                }

                // Validar todos los campos requeridos
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                    alert('Por favor, completa correctamente todos los campos.');
                } else {
                    estado++;
                }

                form.classList.add('was-validated');
                console.log('Estado actual:', estado);

                if (estado === 3) {

                    var formData = {
                        nombre: $('#nombre').val(),
                        apellido: $('#apellido').val(),
                        email: $('#Email').val(),
                        contrasena: $('#Contrasena').val(),
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    };

                    $.ajax({
                        url: '{% url "registrar_usuario" %}',
                        type: 'POST',
                        dataType: 'json',
                        data: formData,
                        success: function (response) {
                            alert('Usuario registrado exitosamente.');
                            window.location.href = "{% url 'home' %}"; 
                        },
                        error: function (xhr, status, error) {
                            alert('Ocurrió un error al registrar el usuario: ', xhr.responseText);
                        }
                    });
                }
            });
        });


    </script>


</body>

</html>